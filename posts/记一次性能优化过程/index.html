<!DOCTYPE html><html lang="zh-CN" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="大型任务的多进程优化过程记录，从3个月优化到3天" /><meta property="og:locale" content="zh_CN" /><meta name="description" content="事情起因是这样的，一天学长找到我说:”学弟啊，你有没有空啊。现在跑机器学习实验，跑3个月结果还跑不出来，你能不能帮我优化一下代码啊？”" /><meta property="og:description" content="事情起因是这样的，一天学长找到我说:”学弟啊，你有没有空啊。现在跑机器学习实验，跑3个月结果还跑不出来，你能不能帮我优化一下代码啊？”" /><link rel="canonical" href="https://tjfish.top//posts/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E8%BF%87%E7%A8%8B/" /><meta property="og:url" content="https://tjfish.top//posts/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E8%BF%87%E7%A8%8B/" /><meta property="og:site_name" content="TjFish" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-12-27T00:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="大型任务的多进程优化过程记录，从3个月优化到3天" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-01-05T16:45:14+08:00","datePublished":"2022-12-27T00:00:00+08:00","description":"事情起因是这样的，一天学长找到我说:”学弟啊，你有没有空啊。现在跑机器学习实验，跑3个月结果还跑不出来，你能不能帮我优化一下代码啊？”","headline":"大型任务的多进程优化过程记录，从3个月优化到3天","mainEntityOfPage":{"@type":"WebPage","@id":"https://tjfish.top//posts/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E8%BF%87%E7%A8%8B/"},"url":"https://tjfish.top//posts/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E8%BF%87%E7%A8%8B/"}</script><title>大型任务的多进程优化过程记录，从3个月优化到3天 | TjFish</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="TjFish"><meta name="application-name" content="TjFish"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.proxy.ustclug.org" ><link rel="dns-prefetch" href="https://fonts.proxy.ustclug.org" ><link rel="preconnect" href="https://fonts-gstatic.proxy.ustclug.org" crossorigin><link rel="dns-prefetch" href="https://fonts-gstatic.proxy.ustclug.org" crossorigin><link rel="preconnect" href="https://fonts.proxy.ustclug.org" ><link rel="dns-prefetch" href="https://fonts.proxy.ustclug.org" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.proxy.ustclug.org/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3339048495146586" crossorigin="anonymous"></script> <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/avatar.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">TjFish</a></div><div class="site-subtitle font-italic">记录生活</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>首页</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>分类</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>标签</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>所有文章</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>关于作者</span> </a><li class="nav-item"> <a href="/project/" class="nav-link"> <i class="fa-fw fas fa-star ml-xl-3 mr-xl-3 unloaded"></i> <span>我的作品</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/TjFish" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['150939023','qq.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> 首页 </a> </span> <span>大型任务的多进程优化过程记录，从3个月优化到3天</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> 文章</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="搜索文章..."> </span> <span id="search-cancel" >取消</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>大型任务的多进程优化过程记录，从3个月优化到3天</h1><div class="post-meta text-muted"><div> 作者 <em> <a href="https://tjfish.github.io/">TjFish</a> </em></div><div class="d-flex"><div> <span> 发表于 <em class="timeago" data-ts="1672070400" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-12-27 </em> </span> <span> 更新于 <em class="timeago" data-ts="1672908314" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2023-01-05 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2994 字"> <em>16 分钟</em>阅读</span></div></div></div><div class="post-content"><p>事情起因是这样的，一天学长找到我说:”学弟啊，你有没有空啊。现在跑机器学习实验，跑3个月结果还跑不出来，你能不能帮我优化一下代码啊？”</p><p>我心想：“一次实验跑三个月，万一写了一点bug，实验不又得重头再来三个月，这也太令人头皮发麻了吧？“</p><p>于是我开始了实验代码优化之旅。</p><h2 id="1整体思路"><span class="mr-2">1.整体思路</span><a href="#1整体思路" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>该项目整体代码量非常多，实验室内已经维护了3~4年，整个项目构建在Pytorch上，会到大数据集进行聚类学习。一次实验涉及到的数据量很大，基本是TB级别。</p><p>仔细看了实验项目框架和执行过程，一时间没有优化思路。</p><p>问了学长，目前所有实验执行都是单核CPU，没有多线程多进程。</p><p>那优化思路不就有了——<strong>并行化</strong>，如果可以开多个进程同时跑实验，效率直接可以翻几十倍（当然最终受限于硬件资源）。</p><p>要代码并行化，要满足以下几个条件</p><ul><li><p>有大量的、重复的、类似的任务，<strong>CPU密集型任务</strong></p><blockquote><p>目前实验时间开销都主要用在聚类操作中，一次实验大概要做800w次聚类，平均一次聚类1s。单核跑大概需要3个月。</p></blockquote><li><p>并行任务之间不能有依赖关系</p><blockquote><p>现有聚类之间有弱依赖关系，但是通过代码逻辑修改可以去掉依赖关系。</p></blockquote></ul><p>因此想到可以把聚类运算给单独拿出来，用多线程聚类来提升效率。</p><p>多线程并行化跑大量任务，很容易就想到<strong>MapReduce</strong>计算框架。</p><blockquote><p>将计算过程分为Map，Reduce两个过程。将大任务分为多个子任务，提前准备好每个子任务的输入数据。Map过程多个Worker（线程、进程）执行执行，完成子任务。Reduce过程将所有子任务结果聚合，形成最终大任务结果。</p></blockquote><p>那么整体的实现思路就有啦：</p><ol><li>数据准备：输出聚类输入数据<li>任务拆分：将聚类输入分为多个子任务<li>多机执行：多进程、多机器并行执行聚类<li>结果合并：汇聚聚类结果得到最终结果</ol><h2 id="2数据准备"><span class="mr-2">2.数据准备</span><a href="#2数据准备" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>要跑并行化代码，首先要把任务所需要的输入数据准备好，即导出聚类输入数据。</p><h3 id="代码执行过程分析"><span class="mr-2">代码执行过程分析</span><a href="#代码执行过程分析" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>聚类数据导出是比较典型的IO密集型任务，可是测试了一下，发现把聚类数据导出就要几天时间。</p><p>理论上磁盘IO速度没有这么慢，因此怀疑数据输出过程中有<strong>复杂的CPU运算</strong>。</p><p>尝试用<a href="https://github.com/joerick/pyinstrument">pyinstrument</a>工具分析了代码的执行过程和每个过程的执行时间。</p><blockquote><p>Pyinstrument 是一个Python 分析器。 以可视化的形式帮助您优化代码，使其更快。 输出信息包含了记录时间、线程数、总耗时、单行代码耗时、CPU执行时间等信息。</p></blockquote><p>这一分析就发现一个大问题，可视化结果如下图。</p><p>输出聚类函数也就是<code class="language-plaintext highlighter-rouge">_out_clustering_values</code>执行了311s，其中有137s的时间浪费在一个<code class="language-plaintext highlighter-rouge">unique</code>函数上。</p><p><img data-src="/assets/img/2022-10-17-记一次性能优化过程.assets/image-20221017221528909.png" alt="image-20221017221528909" data-proofer-ignore></p><p>仔细分析了对应的代码，<code class="language-plaintext highlighter-rouge">unique</code>函数每次都要对几百万的数据做去重，仅仅只为了计算聚类数。然而这根本没有必要，因为一般聚类数远小于聚类输入数据（比如100w数据 聚成128类），这样可以把聚类数设为一个定值。果断将<code class="language-plaintext highlighter-rouge">unique</code>函数去掉，整体效率提升45%。</p><p>除开<code class="language-plaintext highlighter-rouge">unique</code>函数，代码执行过程中还发现一些其他没有必要的小函数，也一并做了优化或去除。</p><h3 id="io密集型优化"><span class="mr-2">IO密集型优化</span><a href="#io密集型优化" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>对于数据导出，没有复杂的CPU运算，是比较典型的<strong>IO密集型任务</strong>。</p><p>对于IO密接型任务的优化主要从两方面进行优化</p><ul><li><p>提升单次磁盘写入数量：</p><ul><li>仔细看了学长的代码，写入文件用的是默认的buffer，只有8192byte。而导出的数据量级为TB，buffer太小导致IO次数过多。<li>通过加上一个大IO缓冲buffer（比如64MB），大幅减少IO次数。</ul><li><p>减少总体数据大小：</p><ul><li>实验用到的聚类数据都是Float型，学长将Float转为字符形式然后写入文件。但是更优化的方法是转为二进制形式，相比于字符形式表示的Float，二进制空间减少接近4倍。<li>根据计算，输出的数据总共有10TB，而服务器的磁盘可用容量只有7T，优化后输出数据为2.1TB。<li>这期间还尝试过把数据先压缩后再写入磁盘，但发现压缩本身相较于磁盘IO更耗费时间，遂放弃。</ul></ul><p><img data-src="/assets/img/2022-10-17-记一次性能优化过程.assets/image-20221018132652938.png" alt="image-20221018132652938" data-proofer-ignore></p><h2 id="3-任务拆分"><span class="mr-2">3. 任务拆分</span><a href="#3-任务拆分" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>一次实验聚类数据有<strong>2T</strong>左右，不可能一次性load进内存进行运算，因此需要对聚类数据做拆分，形成一个个小任务。小任务并发执行，然后将小任务的执行结果进行合并。</p><p>任务拆分本身逻辑比较简单，但是有几个注意点：</p><ul><li><p>聚类数据间有前后顺序，因此要对拆分的任务做好编号，之后需要按顺序合并回去。</p><li><p>任务拆分大小要适中</p><ul><li>任务过大会导致一次任务执行过长，单次失败成本高、此外内存开销大。<li>任务过小导致每次任务执行太快，CPU忙于切换进程而影响性能，此外任务数量太多不方便查看</ul></ul><p>最终的实现是分两层对数据做拆分，第一层根据机器学习模型的各层划分，第二层按照聚类数据，每64~256MB切分为一个子任务。</p><p>分层的任务划分可以给任务带上业务属性，方便后续重复实验。因为实验优化往往是针对某几层做优化，这样只需要重新跑这几层的任务即可。</p><p><img data-src="/assets/img/2022-10-17-记一次性能优化过程.assets/image-20221124001720018.png" alt="第一层-机器学习模型拆分" data-proofer-ignore></p><h2 id="4-多机执行"><span class="mr-2">4. 多机执行</span><a href="#4-多机执行" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>任务拆分好后，就可以使用多进程同时执行任务，充分压榨硬件性能。这里面也有两步优化，第一步是<code class="language-plaintext highlighter-rouge">单机多进程</code>，第二步是<code class="language-plaintext highlighter-rouge">多机多进程</code></p><h3 id="单机多进程"><span class="mr-2">单机多进程</span><a href="#单机多进程" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>python由于GIL(全局解释器锁)的存在，没法真正意义上的并发执行多线程。</p><p>所以需要使用python多进程，这里选择了python官方库<code class="language-plaintext highlighter-rouge">multiprocessing</code>中的进程池管理多进程。</p><p>除开实现多进程聚类的功能需求外，还自己实现了一些<strong>非功能性需求</strong>：</p><ul><li><p>日志输出：</p><ul><li>对于多进程，同时读写一个日志文件会导致竞争问题。这里选择了<code class="language-plaintext highlighter-rouge">concurrent_log_handler</code>对日志文件进行加锁，避免并行冲突。</ul><li><p>支持随时启停：</p><ul><li>任务执行过程中可能由于各自原因失败了，要支持任务从失败的地方继续跑。<li>解决思路是建立tmp目录，执行过程中的数据保存在tmp目录下，任务完成后将执行结果拷贝到result文件夹下。<li>此外单个任务切分不要太大，这样可以降低执行失败时的成本。</ul><li><p>失败任务重试：</p><ul><li>任务执行过程中可能由于各自原因失败了，将自动重试几次。失败任务将单独打印日志，便于分析失败原因。</ul><li><p>结果完整性检查：</p><ul><li>多进程任务执行完后，需要对结果文件总数量进行校验。如果结果文件少于预期，将自动重新执行未完成的任务。</ul><li><p>其他一些统计功能：</p><ul><li>支持查看进度、总任务数。<li>支持测算时间、预计时间。</ul></ul><p>看了下实验室服务器有16个核，32个线程，效率应该可以翻32倍，理论上3个月的任务，3天应该可以跑完。</p><p>下面是任务执行输出的日志部分截图：</p><p><img data-src="/assets/img/2022-10-17-记一次性能优化过程.assets/image-20221124004606580.png" alt="image-20221124004606580" data-proofer-ignore></p><h3 id="多机多进程"><span class="mr-2">多机多进程</span><a href="#多机多进程" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>实验室有多台机器，如果多机一起跑聚类，可以进一步提升效率。</p><p>多台机器同时执行任务，首先要解决的问题是聚类数据同步到多个机器上。这里有几个选择：</p><ol><li><p>直接通过移动硬盘拷贝，把输入数据copy到其他机器上</p><blockquote><p>不可行：当时正值10-1国庆期间，实验室管机房的老师都下班了，机房进不去。</p></blockquote><li><p>在其他机器上重新导出一份聚类输入数据</p><blockquote><p>理论可行，但不是最优的：几台机器配置各不相同，有些机器硬盘容量只有500G，而整个待聚类数据有2.1T。如果只导出部分聚类数据，需要针对不同机器改代码，颇为繁琐且容易出错。</p></blockquote><li><p>其他机器到主机器上下载子任务，下载多少就执行多少</p><blockquote><p>这是最终选择的方案，其他机器通过ssh下载主服务器上的任务数据，每下载一个子任务，就启动一个进程执行。这样屏蔽了各个机器的配置差异，且支持添加新机器，老机器下线。</p></blockquote></ol><p>于是写了一份工具类File_Transfer，使用ssh 从远端拉取数据的代码。</p><p>现在相当于获取任务数据有两种方式，一种是从本地直接读取，一种是从远端通过网络拉取。</p><blockquote><p>这期间还尝试过很多种下载数据的方法，比如rsync 、scp等命令。</p><p>但这些命令方法没法和多进程脚本结合起来，且不好管理数据量，因此最后还是自己写了一份python代码，做更精细化的管理。</p></blockquote><p><img data-src="/assets/img/2022-10-17-记一次性能优化过程.assets/image-20221124005726764.png" alt="image-20221124005726764" data-proofer-ignore></p><p>多机跑出实验结果后，先各自进行结果文件的合并，然后多机再把结果文件传到主服务器上进行第二次合并。因为结果文件比较小，只有100MB不到，因此也不需要额外的优化。</p><p>终于并行化实验顺顺利利的跑起来了，<strong>整个聚类过程从原来的3个月跑不出来，到现在3天跑出结果</strong>。性能优化明显。</p><p>不过这只是整个实验的一小步，距离做完整个实验，似乎还有一大段路要走。</p><h2 id="其他"><span class="mr-2">其他</span><a href="#其他" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>在这次优化过程中，还学到了许多linux指令，用到了许多曾经学到过的知识</p><ul><li><p>统计当前目录下文件的个数（包括子目录），用来统计任务总数和执行情况</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ls -lR| grep "^-" | wc -l
</pre></table></code></div></div><li><p>统计文件大小</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>du -sh
</pre></table></code></div></div><li><p>linux查看网络使用情况</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>iftop -n
</pre></table></code></div></div><li><p>linux查看磁盘IO情况</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>iotop
</pre></table></code></div></div><li><p>python 内存占用分析 <a href="https://github.com/bloomberg/memray">Memray</a></p><li><p>python 耗时分析 <a href="https://github.com/joerick/pyinstrument">pyinstrument</a></p></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/%E8%AF%BE%E7%A8%8B/'>课程</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" class="post-tag no-text-decoration" >性能优化</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 本文由作者按照 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 进行授权</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">分享</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=%E5%A4%A7%E5%9E%8B%E4%BB%BB%E5%8A%A1%E7%9A%84%E5%A4%9A%E8%BF%9B%E7%A8%8B%E4%BC%98%E5%8C%96%E8%BF%87%E7%A8%8B%E8%AE%B0%E5%BD%95%EF%BC%8C%E4%BB%8E3%E4%B8%AA%E6%9C%88%E4%BC%98%E5%8C%96%E5%88%B03%E5%A4%A9+-+TjFish&url=https%3A%2F%2Ftjfish.top%2F%2Fposts%2F%25E8%25AE%25B0%25E4%25B8%2580%25E6%25AC%25A1%25E6%2580%25A7%25E8%2583%25BD%25E4%25BC%2598%25E5%258C%2596%25E8%25BF%2587%25E7%25A8%258B%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="http://connect.qq.com/widget/shareqq/index.html?url=https%3A%2F%2Ftjfish.top%2F%2Fposts%2F%25E8%25AE%25B0%25E4%25B8%2580%25E6%25AC%25A1%25E6%2580%25A7%25E8%2583%25BD%25E4%25BC%2598%25E5%258C%2596%25E8%25BF%2587%25E7%25A8%258B%2F&text=%E5%A4%A7%E5%9E%8B%E4%BB%BB%E5%8A%A1%E7%9A%84%E5%A4%9A%E8%BF%9B%E7%A8%8B%E4%BC%98%E5%8C%96%E8%BF%87%E7%A8%8B%E8%AE%B0%E5%BD%95%EF%BC%8C%E4%BB%8E3%E4%B8%AA%E6%9C%88%E4%BC%98%E5%8C%96%E5%88%B03%E5%A4%A9+-+TjFish" data-toggle="tooltip" data-placement="top" title="QQ" target="_blank" rel="noopener" aria-label="QQ"> <i class="fa-fw fab fa-qq"></i> </a> <a href="http://service.weibo.com/share/share.php?title=%E5%A4%A7%E5%9E%8B%E4%BB%BB%E5%8A%A1%E7%9A%84%E5%A4%9A%E8%BF%9B%E7%A8%8B%E4%BC%98%E5%8C%96%E8%BF%87%E7%A8%8B%E8%AE%B0%E5%BD%95%EF%BC%8C%E4%BB%8E3%E4%B8%AA%E6%9C%88%E4%BC%98%E5%8C%96%E5%88%B03%E5%A4%A9+-+TjFish&url=https%3A%2F%2Ftjfish.top%2F%2Fposts%2F%25E8%25AE%25B0%25E4%25B8%2580%25E6%25AC%25A1%25E6%2580%25A7%25E8%2583%25BD%25E4%25BC%2598%25E5%258C%2596%25E8%25BF%2587%25E7%25A8%258B%2F" data-toggle="tooltip" data-placement="top" title="Weibo" target="_blank" rel="noopener" aria-label="Weibo"> <i class="fa-fw fab fa-weibo"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="分享链接" data-title-succeed="链接已复制！"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">最近更新</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/MIT%E5%88%86%E5%B8%83%E5%BC%8F%E8%AF%BE%E7%A8%8B%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF/">Raft分布式一致性协议的实现思路</a><li><a href="/posts/DDD%E5%85%A5%E9%97%A8%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/">领域驱动设计学习总结与记录</a><li><a href="/posts/%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8%E5%AE%9E%E4%B9%A0%E6%8A%A5%E5%91%8A/">字节跳动实习报告</a><li><a href="/posts/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E8%BF%87%E7%A8%8B/">大型任务的多进程优化过程记录，从3个月优化到3天</a><li><a href="/posts/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8FStrategy/">设计模式-策略模式，封装复杂的领域知识</a></ul></div><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ddd/">DDD</a> <a class="post-tag" href="/tags/oracle-apex/">Oracle Apex</a> <a class="post-tag" href="/tags/github/">github</a> <a class="post-tag" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式</a> <a class="post-tag" href="/tags/k8s/">k8s</a> <a class="post-tag" href="/tags/%E5%B0%8F%E6%8A%80%E5%B7%A7/">小技巧</a> <a class="post-tag" href="/tags/%E7%99%BD%E7%9B%92%E5%AF%86%E7%A0%81%E5%AD%A6/">白盒密码学</a> <a class="post-tag" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a> <a class="post-tag" href="/tags/%E8%AF%BE%E7%A8%8B/">课程</a> <a class="post-tag" href="/tags/git/">git</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">文章内容</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>相关文章</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/%E8%BD%AF%E4%BB%B6%E5%BB%BA%E6%A8%A1%E8%AF%BE%E7%A8%8B_product_backlog/"><div class="card-body"> <em class="timeago small" data-ts="1646755200" > 2022-03-09 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>软件建模——论文阅读Product Backlog</h3><div class="text-muted small"><p> 原文：https://ieeexplore.ieee.org/document/8812076 脑图 论文简述 本文的领域是软件开发，本文的研究对象是产品需求列表（Product Backlog），结果是分析了敏捷开发过程的13个实践流程，6个困难风险带点，然后在理论层面给出了产品需求列表的定义，开发过程中的扮演角色，以及何时会产生需求列表。 敏捷开发过程 Ba...</p></div></div></a></div><div class="card"> <a href="/posts/%E8%BD%AF%E4%BB%B6%E5%BB%BA%E6%A8%A1%E8%AF%BE%E7%A8%8B-%E5%88%86%E4%BA%AB%E6%88%91%E7%9A%84%E4%B8%9A%E5%8A%A1%E5%BB%BA%E6%A8%A1%E7%BB%8F%E5%8E%86/"><div class="card-body"> <em class="timeago small" data-ts="1648137600" > 2022-03-25 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>软件建模——分享我的业务建模经历</h3><div class="text-muted small"><p> 分享我的业务建模经历 我感触最多的是为公司开发一款进销存系统。 项目介绍 公司概况 东莞市久源建材贸易有限公司是一家小微企业，成立于2017年，注册资本100万元。主营业务为五金建材、建筑材料、五金配件、螺杆的加工制作。目前公司在职员工达30人，客户群体规模达300人。 系统功能简介 进销存系统功能是对公司产品采购、商品销售、产品生产、库存管理、财务汇总、数据分析等工作进行信息化...</p></div></div></a></div><div class="card"> <a href="/posts/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8-DDoS%E6%8B%92%E7%BB%9D%E8%AE%BF%E9%97%AE%E6%94%BB%E5%87%BB%E4%B8%8E%E9%98%B2%E5%BE%A1/"><div class="card-body"> <em class="timeago small" data-ts="1648310400" > 2022-03-27 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>网络安全——DDoS拒绝访问攻击与防御</h3><div class="text-muted small"><p> 网络安全——拒绝访问攻击与防御 [TOC] 前置工作 实验系统设计 实验系统架构设计如下图所示。攻击集群由两台本地机器和⼀个云服务器节点组成。其中⽤于攻击的服务器节点配置为1C2G，带宽4Mbps，流量上限500GB/⽉。具体攻击⽅式和过程将在后续章节描述。攻击流量将经由互联⽹到达⼀台位于阿里云的服务器节点。该服务器配置为1C2G，带宽5Mbps，流量上限1000GB/月。 在被攻击⼀...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/k8s%E6%97%A5%E5%BF%97%E9%87%87%E9%9B%86%E6%A1%86%E6%9E%B6%E6%90%AD%E5%BB%BA/" class="btn btn-outline-primary" prompt="上一篇"><p>k8s日志采集框架搭建</p></a> <span class="btn btn-outline-primary disabled" prompt="下一篇"><p>-</p></span></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "TjFish/TjFish.github.io", "data-repo-id": "R_kgDOG90Emg", "data-category": "Announcements", "data-category-id": "DIC_kwDOG90Ems4COBNe", "data-mapping": "title", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "top", "data-lang": "zh-CN", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://tjfish.github.io/">TjFish</a>. <span data-toggle="tooltip" data-placement="top" title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。">保留部分权利。</span></p></div><div class="footer-right"><p class="mb-0"> 本站由 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 生成，采用 <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> 主题。</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ddd/">DDD</a> <a class="post-tag" href="/tags/oracle-apex/">Oracle Apex</a> <a class="post-tag" href="/tags/github/">github</a> <a class="post-tag" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式</a> <a class="post-tag" href="/tags/k8s/">k8s</a> <a class="post-tag" href="/tags/%E5%B0%8F%E6%8A%80%E5%B7%A7/">小技巧</a> <a class="post-tag" href="/tags/%E7%99%BD%E7%9B%92%E5%AF%86%E7%A0%81%E5%AD%A6/">白盒密码学</a> <a class="post-tag" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a> <a class="post-tag" href="/tags/%E8%AF%BE%E7%A8%8B/">课程</a> <a class="post-tag" href="/tags/git/">git</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">搜索结果为空</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/zh.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-2CTWBS5MFX"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-2CTWBS5MFX'); }); </script>
